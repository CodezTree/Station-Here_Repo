어쨋든 서칭이 되서 선택이 되었다고 치자. 그럼 코딩을 어떻게 해야할까?

일단 좌표도 현 좌표로 되었다고 칩시다.

	posLat
	posLng

그러면 이제 표현을 해줘야 겠죠??


1. 해당 선택된 버스 노선만 띄운다.(즉 Refreshing을 다시한다. -> Clear 후에...)

2. 알고리즘을 실행한다.

3. 해당 마커를 커스텀으로 해서 lat, lng을 띄운다. (커스텀 이미지) onClickListener 적용



-알고리즘

1. 현 posLat 와 posLng 으로 부터 가장 가까운 점 i를 선택.

2. i+1 점과 i-1점 둘다 선택해서 i와 i+1, i와 i-1 두 집합으로 직선의 방정식 생성.

3. 해당 방정식에 직교하는,(기울기 곱이 -1 되는)방정식을 만족하며, 현 위치를 지나는 방정식 생성

4. 두 방정식을 연립하여서 최단거리위치 정류장을 보여준다.






이후 할것


정류장을 클릭하고 버튼을 띄워준걸 다시 클릭해서 버스 정류장 선택. 그리고 그 정류장을 선택정류장으로 만들고, 알람을 활성화 시킨다.(서비스를 하나 새로 스타팅한다.- 독립적 서비스)

서버로 정류장 생성 알림을 띄운다. 만약 300m 이내에 버스 정류장이 있다면 합류요청을 서버로 보내서,

서버는 DB에 station을 등록한다.


서버는 주기적으로 클라이언트에게 refresh request를 보내고, 그때마다 클라이언트는 새 버스정류장 정보(추가, 제거할 것)을 받아서

리스트에서 추가 및 삭제후 refreshing을 한다.(MapRefreshHandler)



정보가 업데이트 되면 운전자용에게도 보내준다. 운전자는 3초마다 300m 체크를 실시한다.(어짜피 처리될 정보는 적다!)


300m체크시, 운전자 -> 서버요청 -> 서버는 클라이언트에게 위치요청 -> 클라이언트 response -> 서버의 처리(정류장 유지 및 생성 결정) -> 운전자, 유저
두 클라이언트에게 정보전송




자 그럼 끝났다. 공지만 추가하면 끝날것 같다. 공지는...... 어떻게든 되겠지..

하하 7일 남았다. 제기랄

